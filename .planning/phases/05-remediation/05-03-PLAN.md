---
phase: 05-remediation
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/core/remediation/fixer.ts
  - src/core/remediation/fixer.test.ts
  - src/commands/fix.ts
autonomous: true

must_haves:
  truths:
    - "User can run btar fix to auto-fix lint issues"
    - "Fix delegates to language-specific tools (eslint --fix, ruff --fix)"
    - "Fix reports which files were modified"
    - "Fix works for all detected languages in project"
  artifacts:
    - path: "src/core/remediation/fixer.ts"
      provides: "Language-specific fix tool execution"
      exports: ["runFix", "FixResult", "FIX_TOOLS"]
    - path: "src/commands/fix.ts"
      provides: "Fix command for CLI"
      exports: ["fixCommand"]
  key_links:
    - from: "fixCommand"
      to: "runFix"
      via: "calls runFix for each language"
      pattern: "runFix"
    - from: "FIX_TOOLS"
      to: "LINTER_TOOLS"
      via: "mirrors linter tool structure with --fix flags"
      pattern: "eslint.*--fix|ruff.*--fix"
---

<objective>
Implement auto-fix command that delegates to language-specific fix tools.

Purpose: Enable one-command fixing of lint issues across all detected languages.
Output: Fix command and underlying fix execution logic.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/core/metrics/linter.ts
@src/core/metrics/runner.ts
@src/commands/analyze.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create fix tool configuration</name>
  <files>src/core/remediation/fixer.ts</files>
  <action>
    Create fixer.ts with FIX_TOOLS configuration mirroring LINTER_TOOLS structure but with --fix flags:

    ```typescript
    interface FixTool {
      tool: string;
      command: string[];
      parseOutput: (stdout: string, stderr: string, exitCode: number) => FixResult;
    }

    interface FixResult {
      success: boolean;
      filesModified: number;
      message: string;
    }

    const FIX_TOOLS: Record<SupportedLanguage, FixTool> = {
      typescript: {
        tool: "eslint",
        command: ["npx", "eslint", ".", "--fix"],
        parseOutput: parseEslintFixOutput,
      },
      javascript: {
        tool: "eslint",
        command: ["npx", "eslint", ".", "--fix"],
        parseOutput: parseEslintFixOutput,
      },
      python: {
        tool: "ruff",
        command: ["ruff", "check", ".", "--fix"],
        parseOutput: parseRuffFixOutput,
      },
      go: {
        tool: "gofmt",
        command: ["gofmt", "-w", "."],
        parseOutput: parseGofmtOutput,
      },
      // ... other languages with their fix tools
    };
    ```

    Implement runFix(language: SupportedLanguage, directory: string) â†’ Promise<FixResult>
    Use runTool from metrics/runner.ts for execution.
  </action>
  <verify>npm run build succeeds, fixer.ts exports FixResult and runFix</verify>
  <done>FIX_TOOLS configured for all 9 languages, runFix function implemented</done>
</task>

<task type="auto">
  <name>Task 2: Create fix command</name>
  <files>src/commands/fix.ts, src/cli.ts</files>
  <action>
    Create fix command following analyze command pattern:

    ```typescript
    export async function fixCommand(
      directory: string,
      options: FixOptions = {}
    ): Promise<void> {
      // 1. Detect languages
      // 2. For each language, run fix tool
      // 3. Report results (files modified, success/failure)
      // 4. Exit 1 if any fix failed
    }
    ```

    Options:
    - --quiet: Suppress progress output
    - --language: Fix only specific language (optional filter)

    Wire into cli.ts:
    ```typescript
    program
      .command("fix <directory>")
      .description("Auto-fix lint issues in the codebase")
      .option("-q, --quiet", "Suppress progress output")
      .option("-l, --language <lang>", "Fix only specific language")
      .action(fixCommand);
    ```
  </action>
  <verify>btar fix --help shows command, btar fix . runs without error</verify>
  <done>Fix command registered in CLI, executes fix tools for detected languages</done>
</task>

<task type="auto">
  <name>Task 3: Add basic fix tests</name>
  <files>src/core/remediation/fixer.test.ts</files>
  <action>
    Add tests for fixer module:
    - FIX_TOOLS has entries for all supported languages
    - parseEslintFixOutput extracts file count from output
    - parseRuffFixOutput extracts file count from output
    - runFix returns success: false when tool not found
    - runFix returns success: true with filesModified count

    Use mocking pattern from linter.test.ts for subprocess mocking.
  </action>
  <verify>npm test -- fixer passes all tests</verify>
  <done>Fix module has test coverage for core functionality</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds
- [ ] npm test passes all tests
- [ ] btar fix --help shows fix command
- [ ] btar fix . runs (may report "no languages detected" in empty dir)
</verification>

<success_criteria>
- All tasks completed
- Fix command available in CLI
- Fix tools configured for all 9 languages
- Basic test coverage for fixer module
</success_criteria>

<output>
After completion, create `.planning/phases/05-remediation/05-03-SUMMARY.md`
</output>
