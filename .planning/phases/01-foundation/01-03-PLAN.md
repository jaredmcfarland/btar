---
phase: 01-foundation
plan: 03
type: tdd
wave: 1
depends_on: []
files_modified:
  - src/core/detector.ts
  - src/core/detector.test.ts
  - src/core/types.ts
autonomous: true
must_haves:
  truths:
    - "Detector identifies Python projects (setup.py, pyproject.toml, requirements.txt)"
    - "Detector identifies TypeScript projects (tsconfig.json, package.json with typescript)"
    - "Detector identifies Go projects (go.mod)"
    - "Detector identifies multiple languages in monorepo"
    - "Detector respects exclude patterns from config"
  artifacts:
    - path: "src/core/detector.ts"
      provides: "Language detection logic"
      exports: ["detectLanguages", "LANGUAGE_MARKERS"]
      min_lines: 60
    - path: "src/core/detector.test.ts"
      provides: "Test coverage for detector"
      min_lines: 80
  key_links:
    - from: "detector.ts detectLanguages"
      to: "filesystem"
      via: "file existence checks"
      pattern: "existsSync|readdir"
    - from: "detector.ts"
      to: "LANGUAGE_MARKERS"
      via: "marker lookup"
      pattern: "LANGUAGE_MARKERS"
---

<objective>
Implement language detector using TDD to identify project languages from file markers.

Purpose: Enable automatic detection of TypeScript, Python, Swift, Kotlin, Go, Java, Ruby, PHP.
Output: Tested detector.ts module that scans directories and identifies languages.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
@./.claude/get-shit-done/references/tdd.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/research/STACK.md

**Requirement:** INFRA-02 - User can analyze TypeScript, Python, Swift, Kotlin, Go, Java, Ruby, PHP codebases

**Language markers (from STACK.md research):**
| Language | Primary Markers | Secondary Markers |
|----------|-----------------|-------------------|
| Python | pyproject.toml, setup.py | requirements.txt, *.py |
| TypeScript | tsconfig.json | package.json with "typescript" |
| JavaScript | package.json | *.js, *.mjs |
| Go | go.mod | *.go |
| Java | pom.xml, build.gradle | *.java |
| Kotlin | build.gradle.kts | *.kt |
| Swift | Package.swift, *.xcodeproj | *.swift |
| Ruby | Gemfile | *.rb |
| PHP | composer.json | *.php |

**Detection strategy:**
1. Scan root directory for primary markers
2. If no primary markers, scan for secondary markers (limited depth)
3. Return array of detected languages
</context>

<feature>
  <name>Language Detector</name>
  <files>src/core/detector.ts, src/core/detector.test.ts</files>
  <behavior>
    detectLanguages(directory: string, config: BTARConfig): Promise<DetectedLanguage[]>

    Cases:
    - Python project (pyproject.toml exists) → ["python"]
    - TypeScript project (tsconfig.json exists) → ["typescript"]
    - Go project (go.mod exists) → ["go"]
    - Monorepo with Python + TypeScript → ["python", "typescript"]
    - Empty directory → []
    - Directory with excluded files only → []
    - Ruby project (Gemfile) → ["ruby"]
    - Java project (pom.xml) → ["java"]
    - Kotlin project (build.gradle.kts) → ["kotlin"]
    - Swift project (Package.swift) → ["swift"]
    - PHP project (composer.json) → ["php"]
  </behavior>
  <implementation>
    1. Define LANGUAGE_MARKERS constant mapping languages to file patterns
    2. Define DetectedLanguage type in types.ts
    3. detectLanguages function:
       - List files in directory (non-recursive for primary markers)
       - Check each file against LANGUAGE_MARKERS
       - Filter out excluded paths using config.exclude
       - Return unique detected languages
    4. For secondary detection (if no primary):
       - Use glob pattern matching (depth-limited)
       - Check for file extensions
  </implementation>
</feature>

<verification>
npm run test -- src/core/detector.test.ts passes all tests
</verification>

<success_criteria>
- Failing test written and committed (RED)
- Implementation passes test (GREEN)
- Refactor complete if needed
- All 2-3 commits present
- All 8 target languages have marker definitions
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-03-SUMMARY.md` with:
- RED: What test was written, why it failed
- GREEN: What implementation made it pass
- REFACTOR: What cleanup was done (if any)
- Commits: List of commits produced
</output>
