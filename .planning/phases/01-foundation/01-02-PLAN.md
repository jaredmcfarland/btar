---
phase: 01-foundation
plan: 02
type: tdd
wave: 1
depends_on: []
files_modified:
  - src/core/config.ts
  - src/core/config.test.ts
  - src/core/types.ts
autonomous: true
must_haves:
  truths:
    - "Config loader reads .btar.yaml from specified directory"
    - "Missing config file returns default configuration"
    - "Invalid YAML throws descriptive error"
    - "Custom thresholds override defaults"
  artifacts:
    - path: "src/core/config.ts"
      provides: "Configuration loading with defaults"
      exports: ["loadConfig", "DEFAULT_CONFIG"]
      min_lines: 40
    - path: "src/core/config.test.ts"
      provides: "Test coverage for config loader"
      min_lines: 50
    - path: "src/core/types.ts"
      provides: "TypeScript types for configuration"
      contains: "interface BTARConfig"
  key_links:
    - from: "config.ts loadConfig"
      to: "yaml.parse"
      via: "YAML parsing"
      pattern: "yaml.*parse"
    - from: "config.ts"
      to: "types.ts BTARConfig"
      via: "type import"
      pattern: "import.*BTARConfig.*from.*types"
---

<objective>
Implement configuration loader using TDD for .btar.yaml parsing.

Purpose: Enable users to configure thresholds and exclusions. TDD ensures robust edge case handling.
Output: Tested config.ts module that loads and validates .btar.yaml files.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
@./.claude/get-shit-done/references/tdd.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Requirement:** INFRA-04 - User can configure thresholds and exclusions via `.btar.yaml`

**Config schema (from PROJECT.md Foundation Tier):**
```yaml
# .btar.yaml
thresholds:
  type_strictness: 0       # 0 errors target
  lint_errors: 0           # 0 errors target
  test_coverage: 70        # >70% target
  ci_time: 600             # <10 min (600 seconds)
  flaky_rate: 1            # <1% target

exclude:
  - "node_modules/**"
  - "dist/**"
  - "vendor/**"
  - "*.generated.*"

languages:
  - python
  - typescript
  # If empty, auto-detect all
```

**Dependencies from 01-01:** package.json with yaml and vitest installed
</context>

<feature>
  <name>Configuration Loader</name>
  <files>src/core/config.ts, src/core/config.test.ts, src/core/types.ts</files>
  <behavior>
    loadConfig(directory: string): Promise<BTARConfig>

    Cases:
    - loadConfig("/path/with/.btar.yaml") → parsed config merged with defaults
    - loadConfig("/path/without/config") → DEFAULT_CONFIG
    - loadConfig("/path/with/invalid.yaml") → throws ConfigError with line number
    - loadConfig("/path") with partial config → defaults for missing fields
    - Config with unknown keys → ignored (forward compatibility)
  </behavior>
  <implementation>
    1. Define BTARConfig interface in types.ts
    2. Define DEFAULT_CONFIG constant
    3. loadConfig function:
       - Check if .btar.yaml exists in directory
       - If not, return DEFAULT_CONFIG
       - If yes, read and parse with yaml library
       - Deep merge with DEFAULT_CONFIG
       - Validate threshold ranges
       - Return merged config
  </implementation>
</feature>

<verification>
npm run test -- src/core/config.test.ts passes all tests
</verification>

<success_criteria>
- Failing test written and committed (RED)
- Implementation passes test (GREEN)
- Refactor complete if needed
- All 2-3 commits present
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md` with:
- RED: What test was written, why it failed
- GREEN: What implementation made it pass
- REFACTOR: What cleanup was done (if any)
- Commits: List of commits produced
</output>
