---
phase: 04-context-generation
plan: 01
type: tdd
wave: 1
depends_on: []
files_modified: [src/core/context/agents-md.ts, src/core/context/agents-md.test.ts]
autonomous: true

must_haves:
  truths:
    - "validateAgentsMd returns issues for files missing required sections"
    - "validateAgentsMd returns empty issues for well-formed files"
    - "generateAgentsMd produces valid markdown with detected language info"
  artifacts:
    - path: "src/core/context/agents-md.ts"
      provides: "AGENTS.md validation and generation"
      exports: ["validateAgentsMd", "generateAgentsMd", "AgentsMdValidation"]
    - path: "src/core/context/agents-md.test.ts"
      provides: "TDD test coverage"
      min_lines: 80
  key_links:
    - from: "validateAgentsMd"
      to: "fs.readFileSync"
      via: "reads file from disk"
      pattern: "readFileSync"
    - from: "generateAgentsMd"
      to: "LanguageInfo"
      via: "uses detected language for content"
      pattern: "LanguageInfo"
---

<objective>
Implement AGENTS.md validation and generation via TDD.

Purpose: Enable users to validate existing AGENTS.md files and generate new ones from codebase analysis. AGENTS.md is the standard format for providing context to AI coding agents.
Output: Tested validation and generation functions for AGENTS.md files.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
@./.claude/get-shit-done/references/tdd.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Existing types to use:
@src/core/detector.ts
@src/core/types.ts

# AGENTS.md Format Reference:
# - Flexible Markdown format, no strict required sections
# - Recommended sections: build commands, test commands, code style, project structure
# - Should be <150 lines for optimal agent performance
# - See https://agents.md/ for specification
</context>

<feature>
  <name>AGENTS.md Validation</name>
  <files>src/core/context/agents-md.ts, src/core/context/agents-md.test.ts</files>
  <behavior>
    validateAgentsMd(filePath: string) => AgentsMdValidation

    AgentsMdValidation = {
      exists: boolean
      issues: string[]  // warnings/errors about missing recommended sections
      sections: string[]  // detected section headings
    }

    Cases:
    - File doesn't exist → { exists: false, issues: ["File not found"], sections: [] }
    - File exists but empty → { exists: true, issues: ["Empty file"], sections: [] }
    - File missing "Build" section → { exists: true, issues: ["Missing recommended: Build commands"], sections: [...] }
    - File with all recommended sections → { exists: true, issues: [], sections: [...] }

    Recommended sections to check:
    - Build commands (or "Building", "Setup")
    - Test commands (or "Testing", "Tests")
    - Code style (or "Style", "Formatting", "Conventions")
  </behavior>
  <implementation>
    1. Read file, parse markdown headings
    2. Check for recommended section patterns
    3. Return validation result with issues
  </implementation>
</feature>

<feature>
  <name>AGENTS.md Generation</name>
  <files>src/core/context/agents-md.ts, src/core/context/agents-md.test.ts</files>
  <behavior>
    generateAgentsMd(options: AgentsMdOptions) => string

    AgentsMdOptions = {
      projectName: string
      languages: LanguageInfo[]
      buildCommand?: string
      testCommand?: string
      lintCommand?: string
    }

    Cases:
    - TypeScript project → includes tsc, npm test references
    - Python project → includes pip, pytest references
    - Multi-language → sections for each language
    - Custom commands → uses provided commands over defaults
  </behavior>
  <implementation>
    1. Generate markdown template
    2. Fill in language-specific defaults
    3. Add project-specific overrides
    4. Keep under 150 lines
  </implementation>
</feature>

<verification>
- [ ] npm test passes with new test file
- [ ] validateAgentsMd correctly identifies missing sections
- [ ] generateAgentsMd produces valid markdown
- [ ] Generated AGENTS.md is under 150 lines
</verification>

<success_criteria>
- RED: Failing tests written for validation and generation
- GREEN: Implementation passes all tests
- REFACTOR: Clean up if needed
- All TDD commits present (test, feat, refactor)
</success_criteria>

<output>
After completion, create `.planning/phases/04-context-generation/04-01-SUMMARY.md`
</output>
