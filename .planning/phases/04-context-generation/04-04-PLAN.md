---
phase: 04-context-generation
plan: 04
type: execute
wave: 2
depends_on: ["04-01", "04-02", "04-03"]
files_modified: [src/commands/context.ts, src/cli.ts]
autonomous: false

must_haves:
  truths:
    - "User can run btar context validate to check AGENTS.md"
    - "User can run btar context generate agents-md to create AGENTS.md"
    - "User can run btar context generate pre-commit to create .pre-commit-config.yaml"
    - "User can run btar context generate hooks to create Claude Code hooks"
    - "Generated files are written to correct locations"
  artifacts:
    - path: "src/commands/context.ts"
      provides: "Context subcommands"
      exports: ["contextCommand"]
    - path: "src/cli.ts"
      provides: "CLI with context subcommand"
      contains: "context"
  key_links:
    - from: "context validate"
      to: "validateAgentsMd"
      via: "calls validator and displays results"
      pattern: "validateAgentsMd"
    - from: "context generate"
      to: "generators"
      via: "calls appropriate generator based on subcommand"
      pattern: "generate(AgentsMd|PreCommit|ClaudeHooks)"
---

<objective>
Integrate context generators into CLI with subcommands.

Purpose: Expose AGENTS.md validation, and generation of AGENTS.md, pre-commit config, and Claude Code hooks through the CLI. Users can generate context files for their projects.
Output: Working `btar context` command with validate and generate subcommands.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
@./.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan outputs (must be completed first):
@.planning/phases/04-context-generation/04-01-SUMMARY.md
@.planning/phases/04-context-generation/04-02-SUMMARY.md
@.planning/phases/04-context-generation/04-03-SUMMARY.md

# Existing CLI structure:
@src/cli.ts
@src/commands/analyze.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create context command module</name>
  <files>src/commands/context.ts</files>
  <action>
    Create src/commands/context.ts with Commander subcommands.

    Structure:
    ```
    btar context
      validate [path]           # Validate AGENTS.md (default: ./AGENTS.md)
      generate agents-md [dir]  # Generate AGENTS.md for directory
      generate pre-commit [dir] # Generate .pre-commit-config.yaml
      generate hooks [dir]      # Generate Claude Code hooks
    ```

    For `context validate`:
    - Call validateAgentsMd(path)
    - Display issues or "Valid" message
    - Exit 1 if issues found, 0 if valid

    For `context generate agents-md`:
    - Detect languages in directory
    - Call generateAgentsMd with detected info
    - Write to AGENTS.md (or --output path)
    - Confirm file written

    For `context generate pre-commit`:
    - Detect languages in directory
    - Call generatePreCommitConfig
    - Write to .pre-commit-config.yaml (or --output path)
    - Confirm file written

    For `context generate hooks`:
    - Call generateClaudeHooks
    - Write to .claude/settings.json (create .claude/ if needed, or --output)
    - Confirm file written

    Add --output/-o option to all generate commands for custom output path.
    Add --force/-f option to overwrite existing files.
  </action>
  <verify>tsc --noEmit passes</verify>
  <done>Context command module created with all subcommands</done>
</task>

<task type="auto">
  <name>Task 2: Wire context command into CLI</name>
  <files>src/cli.ts</files>
  <action>
    Import contextCommand from ./commands/context.ts
    Add to program: program.addCommand(contextCommand)

    Ensure help text shows:
    - btar context validate
    - btar context generate agents-md
    - btar context generate pre-commit
    - btar context generate hooks
  </action>
  <verify>npx tsx src/cli.ts context --help shows subcommands</verify>
  <done>Context command accessible from CLI</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete context generation CLI</what-built>
  <how-to-verify>
    1. Build: npm run build
    2. Test validate: npx btar context validate ./AGENTS.md (should show "not found" or validation results)
    3. Test generate agents-md: npx btar context generate agents-md . --output /tmp/test-agents.md
    4. Check generated file: cat /tmp/test-agents.md (should have language-specific content)
    5. Test generate pre-commit: npx btar context generate pre-commit . --output /tmp/test-pre-commit.yaml
    6. Check generated file: cat /tmp/test-pre-commit.yaml (should have repos/hooks)
    7. Test generate hooks: npx btar context generate hooks . --output /tmp/test-hooks.json
    8. Check generated file: cat /tmp/test-hooks.json (should have PreToolUse/PostToolUse)
  </how-to-verify>
  <resume-signal>Type "approved" if all commands work, or describe issues</resume-signal>
</task>

</tasks>

<verification>
- [ ] npm run build succeeds
- [ ] btar context validate works
- [ ] btar context generate agents-md produces valid AGENTS.md
- [ ] btar context generate pre-commit produces valid YAML
- [ ] btar context generate hooks produces valid JSON
- [ ] --output flag works for all generate commands
- [ ] --force flag allows overwriting
</verification>

<success_criteria>
- All tasks completed
- All context subcommands functional
- Generated files are valid and usable
- User verified all commands work
</success_criteria>

<output>
After completion, create `.planning/phases/04-context-generation/04-04-SUMMARY.md`
</output>
