---
phase: 04-context-generation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: [src/core/context/pre-commit.ts, src/core/context/pre-commit.test.ts]
autonomous: true

must_haves:
  truths:
    - "generatePreCommitConfig returns valid YAML for detected language"
    - "Generated config includes language-appropriate hooks"
    - "Multi-language projects get combined config"
  artifacts:
    - path: "src/core/context/pre-commit.ts"
      provides: "Pre-commit config generation"
      exports: ["generatePreCommitConfig", "PreCommitConfig"]
    - path: "src/core/context/pre-commit.test.ts"
      provides: "Test coverage"
      min_lines: 60
  key_links:
    - from: "generatePreCommitConfig"
      to: "LanguageInfo"
      via: "maps language to hooks"
      pattern: "LanguageInfo"
    - from: "generatePreCommitConfig"
      to: "yaml.stringify"
      via: "outputs valid YAML"
      pattern: "stringify"
---

<objective>
Implement pre-commit config generator for detected languages.

Purpose: Generate .pre-commit-config.yaml files with appropriate hooks for the detected project languages. Pre-commit is the standard git hooks framework used across Python, JavaScript, Go, and other ecosystems.
Output: Pre-commit config generator with language-specific hook mappings.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Existing modules:
@src/core/detector.ts
@src/core/types.ts

# Pre-commit format reference:
# repos:
#   - repo: https://github.com/owner/repo
#     rev: vX.Y.Z
#     hooks:
#       - id: hook-id
#         files: \\.ext$
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create pre-commit types and language mapping</name>
  <files>src/core/context/pre-commit.ts</files>
  <action>
    Create src/core/context/ directory if needed.

    Define types:
    - PreCommitHook = { id: string, files?: string, args?: string[], additional_dependencies?: string[] }
    - PreCommitRepo = { repo: string, rev: string, hooks: PreCommitHook[] }
    - PreCommitConfig = { repos: PreCommitRepo[] }

    Create language-to-hooks mapping:
    - TypeScript/JavaScript: prettier, eslint
    - Python: black, ruff, mypy
    - Go: gofmt, golangci-lint
    - Swift: swiftformat, swiftlint
    - Kotlin: ktlint
    - Java: google-java-format
    - Ruby: rubocop
    - PHP: php-cs-fixer

    Use well-known repo URLs and stable versions:
    - pre-commit/pre-commit-hooks (trailing-whitespace, end-of-file-fixer, check-yaml)
    - psf/black (black)
    - astral-sh/ruff-pre-commit (ruff)
    - pre-commit/mirrors-prettier (prettier)
    - pre-commit/mirrors-eslint (eslint)

    Export getHooksForLanguage(language: string): PreCommitRepo[]
  </action>
  <verify>tsc --noEmit passes</verify>
  <done>Types defined, language mapping complete</done>
</task>

<task type="auto">
  <name>Task 2: Implement config generator with tests</name>
  <files>src/core/context/pre-commit.ts, src/core/context/pre-commit.test.ts</files>
  <action>
    Implement generatePreCommitConfig(languages: LanguageInfo[]): string

    Logic:
    1. Always include pre-commit/pre-commit-hooks for basic checks
    2. For each detected language, add language-specific hooks
    3. De-duplicate repos (don't add same repo twice)
    4. Use yaml library to stringify (already in package.json)
    5. Return YAML string

    Write tests covering:
    - Single language (TypeScript only)
    - Multiple languages (Python + TypeScript)
    - Unknown language (falls back to basic hooks only)
    - Generated YAML is parseable
  </action>
  <verify>npm test -- src/core/context/pre-commit.test.ts passes</verify>
  <done>Generator works for all supported languages, tests pass</done>
</task>

</tasks>

<verification>
- [ ] npm run build succeeds
- [ ] npm test passes all pre-commit tests
- [ ] Generated YAML is valid (parseable by yaml library)
- [ ] Each supported language maps to appropriate hooks
</verification>

<success_criteria>
- All tasks completed
- Pre-commit config generates valid YAML
- All 8 supported languages have appropriate hooks
- Tests verify generation logic
</success_criteria>

<output>
After completion, create `.planning/phases/04-context-generation/04-02-SUMMARY.md`
</output>
